<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Links to prefilled forms</title>
    <style>
        body {
            font-size: larger;
        }

        .link {
            width: 100%;
            display: block;
            font-size: 2em;
            padding: 2em 12px;
            color: white;
            background-color: #191943;
            margin-top: 0.2em;
        }

    </style>
    <script>
        function getDateStr(date) {
            const today = date.toISOString()
            const fullDate = today.split('T')[0];
            const parts = fullDate.split("-");
            return parts[2] + "." + parts[1] + "." + parts[0];
        }

        function getDayName(date) {
            return date.toLocaleString('fi-FI', {weekday:'long'})
        }

        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        function encodeWhitespace(text) {
            return text.replaceAll(' ', '%20');
        }

        function randomInteger(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getPrevDate(dayNumber) {
            var d = new Date();
            for (let i = 0; i < 8; i++) {
                let prevDate = new Date((new Date()).valueOf() - 1000*60*60*24*i);
                if (prevDate.getDay() === dayNumber) {
                    return prevDate;
                }
            }
            return null;
        }

        const TOIVIO = {name: 'Toivio', id: 9};
        const NUOLIALA = {name: 'Nuoliala', id: 4};
        const TEAM_P12_RED = {name: 'P12 Red', coach: 'Janne Rintanen'}
        const TEAM_NAISET_HARRASTE = {name: 'Salibandy Naiset harraste ', coach: 'Niina Kuhlman'}
        const PIRKAT = 15;
        const TORSTAI = 4;
        const SUNNUNTAI = 0;

        function addLink(team, dayNumber, startTime, endTime, participantCount, location) {
            var linksContainer = document.getElementById("links");
            var divTag = document.createElement("div");
            let prevDate = getPrevDate(dayNumber);
            divTag.appendChild(document.createTextNode(team.name + ' - ' + getDayName(prevDate) + ' - ' + location.name));

            var aTag = document.createElement("a");
            aTag.setAttribute('class', "link");

            const dataTo = {
                p0e3: 0,
                p0e4: location.id,
                p0e7: getDateStr(prevDate),
                p0e8: startTime,
                p0e9: endTime,
                p0e10: PIRKAT,
                p0e11: encodeWhitespace(team.name),
                p0e12: encodeWhitespace(team.coach),
                p0e13: '' + participantCount
            };
            const sh = getParameterByName("sh");
            const prefix = 'https://my.surveypal.com/app/form/ext?sid=1454790407&sh=' + sh;
            aTag.setAttribute('href', prefix + '&data=' + JSON.stringify(dataTo));

            aTag.appendChild(divTag);
            linksContainer.appendChild(aTag);
        }

        function initialize() {
            addLink(TEAM_P12_RED, TORSTAI, '17:00', '18:00', randomInteger(9, 13), NUOLIALA);
            addLink(TEAM_P12_RED, SUNNUNTAI, '12:00', '13:00', randomInteger(9, 13), TOIVIO);
            addLink(TEAM_NAISET_HARRASTE, TORSTAI, '20:00', '21:00', randomInteger(9, 13), TOIVIO);
        }
    </script>
</head>
<body onLoad="initialize()">
    <div id="links">
    </div>
</body>
</html>